##### (1)调优

​		本阶段是通过相应的测试过程，用以调试出最合适的存储文件数据的映射结构data_map的大小。

​		具体思路为：

- 通过在ExtFUSE框架下的StackFS文件系统中，利用dd压测工具，先生成一个大小为1GB测试文件test，生成命令为：

  ```c
  dd if=/dev/zero of=test bs=1G count=1
  ```

- 接下来利用dd工具来读取test文件，并不断调整读取过程中的块大小（即bs的大小），得出相应的读取速率。读取的命令为：

  ```c
  dd if=test of=/dev/null bs=4k count=262144
  ```

  通过不断调整bs与count的大小，读出读取速率即可。

- 最终的测试结果如下所示：

| data_map\read rate\bs | 4kB     | 32kB    | 128kB   | 512kB   | 1MB     |
| --------------------- | ------- | ------- | ------- | ------- | ------- |
| 4kB                   | 740MB/s | 506MB/s | 576MB/s | 537MB/s | 474MB/s |
| 32kB                  | 775MB/s | 511MB/s | 733MB/s | 729MB/s | 725MB/s |
| 128kB                 | 661MB/s | 659MB/s | 750MB/s | 731MB/s | 718MB/s |
| 512kB                 | 810MB/s | 708MB/s | 802MB/s | 770MB/s | 796MB/s |
| 1024kB                | 765MB/s | 541MB/s | 451MB/s | 466MB/s | 516MB/s |

​		综合上述的测试结果而言，当文件数据映射结构data_map=512kB大小时，StackFS文件系统对于4kB、32kB、128kB、512kB以及1MB大小的数据块进行读取时的速率相较于其他情况下都是更大的。因此，在本次调优阶段中，选出的**最优的data_map的大小为512kB**。

##### (2)测试验证性能优化结果

​		由于ExtFUSE框架之中对于FUSE read方法的优化部分是以生成动态链接库的形式进行加载进FUSE框架之中的，因此，在测试ExtFUSE框架的性能时，需要另外写一个基于libExtFUSE库的StackFS文件系统进行相应测试，无法使用基于libfuse库开发出来的fusedemo文件系统进行测试。

​		因此，在测试验证阶段中，就将基于libfuse库开发的fusedemo文件系统作为未优化前的文件系统，将基于libExtFUSE库生成的libExtFUSE库开发的StackFS文件系统作为优化后的文件系统。在这两个文件系统中，利用dd压测工具进行不同大小数据块的读取测试，采集读取速率，作为性能指标，进行对比。数据采集情况如下表所示：

| filesystem\read rate\bs | 4kB      | 32kB     | 128kB    | 512kB    | 1MB      | average   |
| ----------------------- | -------- | -------- | -------- | -------- | -------- | --------- |
| FUSE(fusedemo)          | 89.4MB/s | 91.6MB/s | 82.0MB/s | 91.0MB/s | 90.2MB/s | 88.84MB/s |
| ExtFUSE(StackFS)        | 810MB/s  | 708MB/s  | 802MB/s  | 770MB/s  | 796MB/s  | 777.2MB/s |
| 性能对比优化            | 9.06     | 7.73     | 9.78     | 8.46     | 8.82     | 8.75      |

​		通过上述表格的描述，优化后的ExtFUSE框架中对于文件数据的读取速率相较于原本的FUSE框架的中的文件读取速率平均提升了8.75倍。大大优化了文件读取过程中的性能开销问题，从而带来了多方面的好处：

- **提升系统整体性能：**通过优化文件系统中文件数据读取的性能，可以加快文件的访问速度，从而提高系统的响应能力和整体性能。
- **加快应用程序的启动和加载时间：**应用程序通常需要读取许多文件数据来完成启动和加载过程。优化文件数据读取性能可以减少启动时间，**提升用户体验**。
- **减少IO负载和资源消耗：**通过优化文件数据读取性能，可以减少不必要的IO操作，降低系统的IO负载，同时节省系统资源，如CPU和磁盘资源。
- **提高系统的可靠性和稳定性：**优化文件数据读取性能有助于减少IO错误和延迟，降低系统崩溃或数据损坏的风险，从而提高系统的可靠性和稳定性。